<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello World!</title>
    <!-- https://electronjs.org/docs/tutorial/security#csp-meta-tag -->
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' 'unsafe-inline';"
    />
  </head>
  <body>
    <button id="image-load-button">Load Images</button>
    <div id="buttons-div">
      <h2>Backgrounds</h2>
      <ul>
        <li>
          <button data-layer="backgrounds" data-imagePath="backgrounds/background.png">Background</button>
        </li>
      </ul>

      <h2>Characters</h2>
      <ul>
        <li>
          <button data-layer="characters" data-imagePath="character_base/body.png">Character Base</button>
        </li>
      </ul>

      <h2>Costumes</h2>
      <ul>
        <li>
          <button data-layer="costumes" data-imagePath="costumes/shirt.png">Shirt</button>
        </li>
        <li>
          <button data-layer="costumes" data-imagePath="costumes/jacket.png">Jacket</button>
        </li>
      </ul>

      <h2>Emotions</h2>
      <ul id="emotions">
      </ul>
    </div>

    <script>
      const electron = require("electron");
      const { ipcRenderer } = electron;
      const path = require('path');
      const url = require('url');

      const buttonsDiv = document.querySelector('#buttons-div');
      buttonsDiv.addEventListener('click', function(e){
        console.log('sending showImage message')
        ipcRenderer.send("showImage", e.target.dataset.layer, e.target.dataset.imagepath);
      });

      const loadButton = document.querySelector('#image-load-button');
      loadButton.addEventListener('click', function(){
        ipcRenderer.send("loadImages");
      });

      ipcRenderer.on('loadImages', function(e, layer, files){
        console.log('received loadImages event', layer, files);
        appendButtons(layer, files);
      })

      function appendButtons(layer, files) {
        const ul = document.querySelector('#' + layer);
        files.forEach(f => {
          const li = document.createElement('li');
          const button = document.createElement('button');
          button.innerText = f.split('.')[0];
          button.dataset.layer = layer;
          button.dataset.imagepath = layer + '/' + f;
          li.appendChild(button);
          ul.appendChild(li);
        });
      }

      // appendButtons('emotions', ["happy.png","sad.png"]);
    </script>
  </body>
</html>
